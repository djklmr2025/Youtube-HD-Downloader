<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YouTube Playlist Extractor - Final</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 24px;
      padding: 40px;
      max-width: 900px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.5s ease-out;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    h1 {
      color: #1a1a2e;
      font-size: 32px;
      font-weight: 800;
      margin-bottom: 10px;
      text-align: center;
    }

    .subtitle {
      color: #667eea;
      text-align: center;
      margin-bottom: 30px;
      font-size: 16px;
    }

    .input-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      color: #1a1a2e;
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 14px;
    }

    input[type="text"] {
      width: 100%;
      padding: 14px 18px;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      font-size: 15px;
      transition: all 0.3s ease;
      font-family: 'Inter', sans-serif;
    }

    input[type="text"]:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    }

    .api-section {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      border: 2px dashed #dee2e6;
    }

    .api-section.active {
      border-color: #667eea;
      background: #f0f4ff;
    }

    .button-group {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      margin-top: 20px;
    }

    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 14px 20px;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .btn-force {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
    }

    .btn-force:hover {
      box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
    }

    .btn-api {
      background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
      box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
    }

    .btn-api:hover {
      box-shadow: 0 6px 20px rgba(76, 175, 80, 0.6);
    }

    .results {
      margin-top: 30px;
      display: none;
    }

    .results.show {
      display: block;
      animation: fadeIn 0.5s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .results-title {
      color: #1a1a2e;
      font-weight: 700;
      font-size: 18px;
    }

    .count {
      background: #4caf50;
      color: white;
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
    }

    .count.partial {
      background: #ff9800;
    }

    textarea {
      width: 100%;
      min-height: 300px;
      padding: 16px;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      resize: vertical;
      margin-bottom: 15px;
    }

    textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    }

    .action-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
    }

    .btn-secondary {
      background: white;
      color: #667eea;
      border: 2px solid #667eea;
      box-shadow: none;
    }

    .btn-secondary:hover {
      background: #667eea;
      color: white;
    }

    .btn-jd {
      background: white;
      color: #ff9800;
      border: 2px solid #ff9800;
      box-shadow: none;
    }

    .btn-jd:hover {
      background: #ff9800;
      color: white;
    }

    .loading {
      display: none;
      text-align: center;
      margin: 20px 0;
    }

    .loading.show {
      display: block;
    }

    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .error {
      background: #fee;
      border: 2px solid #fcc;
      color: #c33;
      padding: 14px;
      border-radius: 12px;
      margin-top: 15px;
      display: none;
    }

    .error.show {
      display: block;
      animation: shake 0.5s ease-out;
    }

    @keyframes shake {

      0%,
      100% {
        transform: translateX(0);
      }

      25% {
        transform: translateX(-10px);
      }

      75% {
        transform: translateX(10px);
      }
    }

    .success {
      background: #e8f5e9;
      border: 2px solid #4caf50;
      color: #2e7d32;
      padding: 14px;
      border-radius: 12px;
      margin-top: 15px;
      display: none;
    }

    .success.show {
      display: block;
    }

    .warning {
      background: #fff3e0;
      border: 2px solid #ff9800;
      color: #e65100;
      padding: 14px;
      border-radius: 12px;
      margin-top: 15px;
      display: none;
    }

    .warning.show {
      display: block;
    }

    .info {
      background: #e3f2fd;
      border: 2px solid #90caf9;
      color: #1565c0;
      padding: 14px;
      border-radius: 12px;
      margin-top: 15px;
      font-size: 14px;
    }

    .info strong {
      display: block;
      margin-bottom: 5px;
    }

    .debug {
      background: #fff3cd;
      border: 2px solid #ffc107;
      color: #856404;
      padding: 10px;
      border-radius: 8px;
      margin-top: 10px;
      font-size: 12px;
      display: none;
    }

    .debug.show {
      display: block;
    }

    .method-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      margin-left: 10px;
    }

    .method-normal {
      background: #e3f2fd;
      color: #1976d2;
    }

    .method-forced {
      background: #ffebee;
      color: #c62828;
    }

    .method-api {
      background: #e8f5e9;
      color: #2e7d32;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>ðŸŽµ YouTube Playlist Extractor</h1>
    <p class="subtitle">Extrae videos de playlists con 3 mÃ©todos diferentes</p>

    <div class="input-group">
      <label for="playlistUrl">URL de la Playlist de YouTube:</label>
      <input type="text" id="playlistUrl" placeholder="https://www.youtube.com/playlist?list=...">
    </div>

    <div class="api-section" id="apiSection">
      <label for="apiKey">ðŸ”‘ YouTube API Key (Opcional - Para garantizar 100%):</label>
      <input type="text" id="apiKey" placeholder="AIzaSy... (dÃ©jalo vacÃ­o si no tienes)">
      <small style="color: #666; display: block; margin-top: 5px;">
        ðŸ’¡ <a href="https://console.cloud.google.com/apis/credentials" target="_blank" style="color: #667eea;">ObtÃ©n una
          API Key gratis aquÃ­</a>
      </small>
    </div>

    <div class="button-group">
      <button class="btn" id="normalBtn">
        ðŸ“‹ Extraer Normal
      </button>
      <button class="btn btn-force" id="forceBtn">
        ðŸš€ Forzar 100%
      </button>
      <button class="btn btn-api" id="apiBtn">
        âœ… Usar API Key
      </button>
    </div>

    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p id="loadingText">Extrayendo URLs...</p>
    </div>

    <div class="error" id="error"></div>
    <div class="success" id="success"></div>
    <div class="warning" id="warning"></div>
    <div class="debug" id="debug"></div>

    <div class="info">
      <strong>ðŸ“Œ MÃ©todos disponibles:</strong>
      <span class="method-badge method-normal">NORMAL</span> RÃ¡pido, obtiene ~100 videos<br>
      <span class="method-badge method-forced">FORZAR 100%</span> ExtracciÃ³n profunda, obtiene TODOS (puede tardar
      mÃ¡s)<br>
      <span class="method-badge method-api">API KEY</span> Oficial de YouTube, 100% garantizado y rÃ¡pido
    </div>

    <div class="results" id="results">
      <div class="results-header">
        <span class="results-title">URLs ExtraÃ­das:</span>
        <span class="count" id="count">0 videos</span>
      </div>
      <textarea id="urlList" readonly></textarea>
      <div class="action-buttons">
        <button class="btn btn-secondary" id="copyBtn">ðŸ“‹ Copiar</button>
        <button class="btn" id="downloadBtn">ðŸ’¾ .TXT</button>
        <button class="btn btn-jd" id="dlcBtn">ðŸ“¦ .DLC</button>
      </div>
    </div>
  </div>

  <script>
    const playlistInput = document.getElementById('playlistUrl');
    const apiKeyInput = document.getElementById('apiKey');
    const apiSection = document.getElementById('apiSection');
    const normalBtn = document.getElementById('normalBtn');
    const forceBtn = document.getElementById('forceBtn');
    const apiBtn = document.getElementById('apiBtn');
    const loading = document.getElementById('loading');
    const loadingText = document.getElementById('loadingText');
    const error = document.getElementById('error');
    const success = document.getElementById('success');
    const warning = document.getElementById('warning');
    const debug = document.getElementById('debug');
    const results = document.getElementById('results');
    const urlList = document.getElementById('urlList');
    const count = document.getElementById('count');
    const copyBtn = document.getElementById('copyBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const dlcBtn = document.getElementById('dlcBtn');

    let currentUrls = [];
    let currentMethod = '';

    // Cargar API key guardada
    const savedApiKey = localStorage.getItem('youtube_api_key');
    if (savedApiKey) {
      apiKeyInput.value = savedApiKey;
    }

    // Highlight API section cuando se escribe
    apiKeyInput.addEventListener('input', () => {
      if (apiKeyInput.value.trim()) {
        apiSection.classList.add('active');
      } else {
        apiSection.classList.remove('active');
      }
    });

    function showError(message) {
      error.textContent = message;
      error.classList.add('show');
      success.classList.remove('show');
      warning.classList.remove('show');
      setTimeout(() => error.classList.remove('show'), 10000);
    }

    function showSuccess(message) {
      success.textContent = message;
      success.classList.add('show');
      error.classList.remove('show');
      warning.classList.remove('show');
      setTimeout(() => success.classList.remove('show'), 5000);
    }

    function showWarning(message) {
      warning.textContent = message;
      warning.classList.add('show');
      setTimeout(() => warning.classList.remove('show'), 8000);
    }

    function showDebug(message) {
      debug.textContent = message;
      debug.classList.add('show');
    }

    function extractPlaylistId(url) {
      const regex = /[?&]list=([^&]+)/;
      const match = url.match(regex);
      return match ? match[1] : null;
    }

    function createDLC(urls) {
      const dlcData = `<dlc>
<header>
<generator>YouTube Playlist Extractor</generator>
</header>
<content>
<package name="YouTube Playlist" passwords="" comment="">
${urls.map(url => `<file><url>${btoa(url)}</url></file>`).join('\n')}
</package>
</content>
</dlc>`;
      return dlcData;
    }

    function displayResults(videoIds, method) {
      currentMethod = method;
      const urls = videoIds.map(id => `https://www.youtube.com/watch?v=${id}`);
      currentUrls = urls;

      urlList.value = urls.join('\n');
      count.textContent = `${urls.length} video${urls.length !== 1 ? 's' : ''}`;

      // Cambiar color del badge segÃºn cantidad
      if (urls.length >= 100 && method !== 'api') {
        count.classList.add('partial');
        count.classList.remove('complete');
      } else {
        count.classList.remove('partial');
      }

      results.classList.add('show');
    }

    // MÃ‰TODO 1: ExtracciÃ³n Normal (~100 videos)
    async function extractNormal(playlistId) {
      loadingText.textContent = 'Extrayendo con mÃ©todo normal...';
      showDebug('MÃ©todo: ExtracciÃ³n rÃ¡pida estÃ¡ndar');

      const proxies = [
        { name: 'CorsProxy', url: (id) => `https://corsproxy.io/?${encodeURIComponent(`https://www.youtube.com/playlist?list=${id}`)}` },
        { name: 'AllOrigins', url: (id) => `https://api.allorigins.win/raw?url=${encodeURIComponent(`https://www.youtube.com/playlist?list=${id}`)}` }
      ];

      let html = '';
      for (const proxy of proxies) {
        try {
          showDebug(`Intentando con ${proxy.name}...`);
          const response = await fetch(proxy.url(playlistId));
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          html = await response.text();
          showDebug(`âœ“ Conectado con ${proxy.name}`);
          break;
        } catch (err) {
          continue;
        }
      }

      if (!html) throw new Error('No se pudo conectar. Intenta con otro mÃ©todo.');

      const videoIds = new Set();
      const regex = /"videoId":"([a-zA-Z0-9_-]{11})"/g;
      let match;
      while ((match = regex.exec(html)) !== null) {
        videoIds.add(match[1]);
      }

      const uniqueIds = Array.from(videoIds);

      if (uniqueIds.length >= 100) {
        showWarning(`âš ï¸ MÃ©todo normal obtuvo ${uniqueIds.length} videos. Para obtener TODOS, usa "Forzar 100%" o "API Key"`);
      } else {
        showSuccess(`âœ… ExtracciÃ³n completada: ${uniqueIds.length} videos`);
      }

      return uniqueIds;
    }

    // MÃ‰TODO 2: Forzar 100% (ExtracciÃ³n profunda)
    async function extractForced(playlistId) {
      loadingText.textContent = 'Forzando extracciÃ³n completa... Esto puede tardar un poco';
      showDebug('MÃ©todo: ExtracciÃ³n profunda con mÃºltiples intentos');

      // Intentar con diferentes proxies y mÃ©todos
      const videoIds = new Set();

      // Intento 1: Proxy normal
      try {
        const response = await fetch(`https://corsproxy.io/?${encodeURIComponent(`https://www.youtube.com/playlist?list=${playlistId}`)}`);
        const html = await response.text();

        // Extraer de ytInitialData
        const initialDataMatch = html.match(/var ytInitialData = ({.+?});/);
        if (initialDataMatch) {
          const data = JSON.parse(initialDataMatch[1]);
          const extractFromObject = (obj) => {
            if (typeof obj !== 'object' || obj === null) return;
            if (obj.videoId && typeof obj.videoId === 'string' && obj.videoId.length === 11) {
              videoIds.add(obj.videoId);
            }
            for (const key in obj) {
              extractFromObject(obj[key]);
            }
          };
          extractFromObject(data);
        }

        // Extraer con regex tambiÃ©n
        const regex = /"videoId":"([a-zA-Z0-9_-]{11})"/g;
        let match;
        while ((match = regex.exec(html)) !== null) {
          videoIds.add(match[1]);
        }

        showDebug(`ExtracciÃ³n profunda: ${videoIds.size} videos encontrados`);
      } catch (err) {
        showDebug(`Error en extracciÃ³n profunda: ${err.message}`);
      }

      const uniqueIds = Array.from(videoIds);

      if (uniqueIds.length >= 100) {
        showWarning(`âš ï¸ Se obtuvieron ${uniqueIds.length} videos. Para playlists muy grandes (+100), se recomienda usar API Key para garantizar el 100%`);
      } else {
        showSuccess(`âœ… ExtracciÃ³n forzada completada: ${uniqueIds.length} videos`);
      }

      return uniqueIds;
    }

    // MÃ‰TODO 3: Con API Key (100% garantizado)
    async function extractWithAPI(playlistId, apiKey) {
      loadingText.textContent = 'Usando YouTube API oficial...';
      showDebug('MÃ©todo: YouTube Data API v3');

      const allVideoIds = [];
      let nextPageToken = '';
      let pageCount = 0;

      do {
        pageCount++;
        loadingText.textContent = `Usando API - PÃ¡gina ${pageCount}...`;

        const url = `https://www.googleapis.com/youtube/v3/playlistItems?part=contentDetails&maxResults=50&playlistId=${playlistId}&pageToken=${nextPageToken}&key=${apiKey}`;

        const response = await fetch(url);

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error.message || 'Error en la API de YouTube');
        }

        const data = await response.json();

        data.items.forEach(item => {
          allVideoIds.push(item.contentDetails.videoId);
        });

        nextPageToken = data.nextPageToken || '';
        showDebug(`API - PÃ¡gina ${pageCount}: ${data.items.length} videos. Total: ${allVideoIds.length}`);

      } while (nextPageToken);

      showSuccess(`âœ… Â¡Perfecto! API obtuvo TODOS los ${allVideoIds.length} videos`);

      // Guardar API key
      localStorage.setItem('youtube_api_key', apiKey);

      return allVideoIds;
    }

    // Event Listeners para los botones
    async function handleExtraction(method) {
      const url = playlistInput.value.trim();

      if (!url) {
        showError('Por favor ingresa un URL de playlist');
        return;
      }

      const playlistId = extractPlaylistId(url);
      if (!playlistId) {
        showError('URL invÃ¡lido. Debe ser un enlace de playlist de YouTube');
        return;
      }

      if (method === 'api') {
        const apiKey = apiKeyInput.value.trim();
        if (!apiKey) {
          showError('Por favor ingresa tu YouTube API Key');
          apiKeyInput.focus();
          return;
        }
      }

      loading.classList.add('show');
      results.classList.remove('show');
      error.classList.remove('show');
      success.classList.remove('show');
      warning.classList.remove('show');
      debug.classList.remove('show');
      normalBtn.disabled = true;
      forceBtn.disabled = true;
      apiBtn.disabled = true;

      try {
        let videoIds;

        if (method === 'normal') {
          videoIds = await extractNormal(playlistId);
        } else if (method === 'force') {
          videoIds = await extractForced(playlistId);
        } else if (method === 'api') {
          const apiKey = apiKeyInput.value.trim();
          videoIds = await extractWithAPI(playlistId, apiKey);
        }

        displayResults(videoIds, method);

      } catch (err) {
        showError(`âŒ Error: ${err.message}`);
      } finally {
        loading.classList.remove('show');
        loadingText.textContent = 'Extrayendo URLs...';
        normalBtn.disabled = false;
        forceBtn.disabled = false;
        apiBtn.disabled = false;
      }
    }

    normalBtn.addEventListener('click', () => handleExtraction('normal'));
    forceBtn.addEventListener('click', () => handleExtraction('force'));
    apiBtn.addEventListener('click', () => handleExtraction('api'));

    copyBtn.addEventListener('click', () => {
      urlList.select();
      document.execCommand('copy');
      const originalText = copyBtn.textContent;
      copyBtn.textContent = 'âœ… Copiado!';
      setTimeout(() => copyBtn.textContent = originalText, 2000);
    });

    downloadBtn.addEventListener('click', () => {
      const text = urlList.value;
      const blob = new Blob([text], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'youtube-playlist-urls.txt';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      const originalText = downloadBtn.textContent;
      downloadBtn.textContent = 'âœ… Descargado!';
      setTimeout(() => downloadBtn.textContent = originalText, 2000);
    });

    dlcBtn.addEventListener('click', () => {
      if (currentUrls.length === 0) {
        showError('No hay URLs para exportar');
        return;
      }
      const dlcContent = createDLC(currentUrls);
      const blob = new Blob([dlcContent], { type: 'application/x-dlc' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'youtube-playlist.dlc';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      const originalText = dlcBtn.textContent;
      dlcBtn.textContent = 'âœ… Creado!';
      setTimeout(() => dlcBtn.textContent = originalText, 2000);
    });

    // Enter para extraer
    playlistInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        normalBtn.click();
      }
    });
  </script>
</body>

</html>